<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">116</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">31803</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">201</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">2395 (7.53%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#typescript-clones">typescript</a></td><td class="py-3 px-6">67</td><td class="py-3 px-6">20408</td><td class="py-3 px-6">172</td><td class="py-3 px-6">2043</td><td class="py-3 px-6">17386</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#javascript-clones">javascript</a></td><td class="py-3 px-6">24</td><td class="py-3 px-6">3635</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#tsx-clones">tsx</a></td><td class="py-3 px-6">24</td><td class="py-3 px-6">7702</td><td class="py-3 px-6">29</td><td class="py-3 px-6">352</td><td class="py-3 px-6">2970</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#css-clones">css</a></td><td class="py-3 px-6">1</td><td class="py-3 px-6">58</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td><td class="py-3 px-6">0</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="typescript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">typescript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">src/app/api/sessions/[id]/route.ts (Line 120:23 - Line 146:27), src/app/api/sessions/[id]/route.ts (Line 64:21 - Line 90:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-typescript text-sm text-gray-800">,
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    if (error instanceof Error) {
      if (error.message === 'User not authenticated') {
        const errorResponse: ErrorResponse = {
          error: 'AUTHENTICATION_ERROR',
          message: 'Authentication required',
        }
        return NextResponse.json(errorResponse, { status: 401 })
      }

      if (error.message === 'Session not found') {
        const errorResponse: ErrorResponse = {
          error: 'NOT_FOUND',
          message: 'Session not found',
        }
        return NextResponse.json(errorResponse, { status: 404 })
      }
    }

    const errorResponse: ErrorResponse = {
      error: 'INTERNAL_ERROR',
      message: 'Failed to update session'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/sessions/[id]/route.ts (Line 167:26 - Line 198:27), src/app/api/sessions/[id]/route.ts (Line 59:23 - Line 90:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-typescript text-sm text-gray-800">, error)

    if (error instanceof z.ZodError) {
      const errorResponse: ErrorResponse = {
        error: 'VALIDATION_ERROR',
        message: 'Invalid session ID',
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    if (error instanceof Error) {
      if (error.message === 'User not authenticated') {
        const errorResponse: ErrorResponse = {
          error: 'AUTHENTICATION_ERROR',
          message: 'Authentication required',
        }
        return NextResponse.json(errorResponse, { status: 401 })
      }

      if (error.message === 'Session not found') {
        const errorResponse: ErrorResponse = {
          error: 'NOT_FOUND',
          message: 'Session not found',
        }
        return NextResponse.json(errorResponse, { status: 404 })
      }
    }

    const errorResponse: ErrorResponse = {
      error: 'INTERNAL_ERROR',
      message: 'Failed to delete session'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 88:6 - Line 99:5), src/app/api/paints/[id]/route.ts (Line 17:4 - Line 28:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-typescript text-sm text-gray-800">(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Validate paint ID
    const paintId = PaintIdSchema.parse(params.id);

    const body</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 105:11 - Line 119:7), src/app/api/paints/[id]/route.ts (Line 29:3 - Line 43:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-typescript text-sm text-gray-800">);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'NOT_FOUND' ? 404 : 500 }
      );
    }

    return</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 128:32 - Line 135:22), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid update data'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 135:22 - Line 157:7), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 88:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function DELETE</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 157:7 - Line 168:40), src/app/api/paints/[id]/route.ts (Line 17:4 - Line 28:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-typescript text-sm text-gray-800">(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Validate paint ID
    const paintId = PaintIdSchema.parse(params.id);

    // Check for soft delete vs hard delete</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 183:2 - Line 198:2), src/app/api/paints/[id]/route.ts (Line 29:2 - Line 120:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-typescript text-sm text-gray-800">

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'NOT_FOUND' ? 404 : 500 }
      );
    }

    return NextResponse.json({
      data: {</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/[id]/route.ts (Line 209:33 - Line 236:2), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid paint ID',
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/image/extract-color/route.ts (Line 78:4 - Line 89:4), src/app/api/image/extract-color/route.ts (Line 61:4 - Line 72:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-typescript text-sm text-gray-800">

  const rgb = hslToRgb(hue / 360, saturation, lightness)
  const hex = rgbToHex(rgb.r, rgb.g, rgb.b)
  const lab = hexToLab(hex)

  return { hex, lab }
}

/**
 * Simple hash function for consistent color generation
 */</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/image/extract-color/route.ts (Line 208:32 - Line 219:6), src/app/api/sessions/[id]/route.ts (Line 115:24 - Line 126:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-typescript text-sm text-gray-800">, error)

    if (error instanceof z.ZodError) {
      const errorResponse: ErrorResponse = {
        error: 'VALIDATION_ERROR',
        message: 'Invalid request data',
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    const</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/image/extract-color/route.ts (Line 230:27 - Line 240:2), src/app/api/sessions/[id]/route.ts (Line 207:28 - Line 217:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-typescript text-sm text-gray-800"> },
    { status: 405 }
  )
}

export async function PUT() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'PUT method not supported' },
    { status: 405 }
  )
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 19:2 - Line 29:7), src/app/api/paints/[id]/route.ts (Line 5:6 - Line 15:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-typescript text-sm text-gray-800">;

async function getCurrentUser(supabase: any) {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) {
    throw new Error('Unauthorized');
  }
  return user;
}

export</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 30:9 - Line 37:26), src/app/api/paints/[id]/route.ts (Line 18:8 - Line 25:21)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-typescript text-sm text-gray-800">: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Validate collection ID</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 41:13 - Line 57:23), src/app/api/paints/[id]/route.ts (Line 29:8 - Line 45:18)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-typescript text-sm text-gray-800">, user.id);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'NOT_FOUND' ? 404 : 500 }
      );
    }

    if (!result.data) {
      return NextResponse.json(
        { error: { code: 'NOT_FOUND', message: 'Collection not found'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 128:35 - Line 135:24), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid collection ID'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 135:24 - Line 168:5), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 40:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function PATCH(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Validate collection ID
    const collectionId = CollectionIdSchema.parse(params.id);

    const body</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 212:13 - Line 230:14), src/app/api/paints/[id]/route.ts (Line 105:8 - Line 123:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-typescript text-sm text-gray-800">, user.id, updateData);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'NOT_FOUND' ? 404 : 500 }
      );
    }

    return NextResponse.json({
      data: result.data,
      meta: {
        updated_at: result.data?.updated_at,
        collection_id</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 235:37 - Line 275:4), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 40:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid update data',
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function DELETE(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Validate collection ID
    const collectionId = CollectionIdSchema.parse(params.id);

    const url</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 283:17 - Line 290:43), src/app/api/collections/[id]/route.ts (Line 55:7 - Line 62:48)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-typescript text-sm text-gray-800">.data) {
      return NextResponse.json(
        { error: { code: 'NOT_FOUND', message: 'Collection not found' } },
        { status: 404 }
      );
    }

    // Check if this is the default collection</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 327:2 - Line 338:4), src/app/api/paints/[id]/route.ts (Line 182:2 - Line 39:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-typescript text-sm text-gray-800">;
    }

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 348:15 - Line 356:38), src/app/api/paints/[id]/route.ts (Line 201:8 - Line 209:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-typescript text-sm text-gray-800">
      },
      meta: {
        deleted_at: new Date().toISOString()
      }
    });

  } catch (error) {
    console.error('DELETE /api/collections/[id] error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/[id]/route.ts (Line 356:38 - Line 383:2), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid collection ID',
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/auth/email-signin/route.ts (Line 109:2 - Line 117:62), src/app/api/auth/email-signin/route.ts (Line 98:39 - Line 106:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-typescript text-sm text-gray-800">
      recordAuthAttempt(ipAddress)
      return NextResponse.json(
        { error: 'invalid_credentials', message: 'Invalid email or password' },
        { status: 401 }
      )
    }

    // Check lockout status BEFORE password verification (FR-012)</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 39:2 - Line 45:10), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 23:2 - Line 29:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(), purchase_date: new Date().toISOString(),
    notes: null, tags: [], archived: false,
    created_at: new Date().toISOString(), updated_at: new Date().toISOString()
  },
  {
    id: 'paint-3'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 55:2 - Line 61:10), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 23:2 - Line 29:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(), purchase_date: new Date().toISOString(),
    notes: null, tags: [], archived: false,
    created_at: new Date().toISOString(), updated_at: new Date().toISOString()
  },
  {
    id: 'paint-4'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 71:2 - Line 77:10), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 23:2 - Line 29:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(), purchase_date: new Date().toISOString(),
    notes: null, tags: [], archived: false,
    created_at: new Date().toISOString(), updated_at: new Date().toISOString()
  },
  {
    id: 'paint-5'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 87:2 - Line 93:10), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 23:2 - Line 29:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(), purchase_date: new Date().toISOString(),
    notes: null, tags: [], archived: false,
    created_at: new Date().toISOString(), updated_at: new Date().toISOString()
  },
  {
    id: 'paint-6'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 103:2 - Line 108:1), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 23:2 - Line 27:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(), purchase_date: new Date().toISOString(),
    notes: null, tags: [], archived: false,
    created_at: new Date().toISOString(), updated_at: new Date().toISOString()
  }
</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 212:2 - Line 225:3), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 161:11 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-typescript text-sm text-gray-800">.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 75</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 249:20 - Line 263:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 160:2 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-typescript text-sm text-gray-800">
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 150</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 304:2 - Line 318:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 212:2 - Line 175:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-typescript text-sm text-gray-800">).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 353:2 - Line 367:3), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 211:21 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-typescript text-sm text-gray-800">
        available_paints: mockPaints.slice(0, 4).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 80</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 405:14 - Line 418:3), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 161:11 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-typescript text-sm text-gray-800">.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 50</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 441:2 - Line 454:5), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 212:2 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-typescript text-sm text-gray-800">).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 1000</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 457:5 - Line 469:7), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 228:6 - Line 241:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-typescript text-sm text-gray-800">
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'tpe_hybrid',
          max_iterations: 100,
          time_limit_ms: 8000,
          quality_vs_speed: 'balanced'
        }
      });

      expect(result.success).toBe(true);
      </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 487:2 - Line 503:2), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 160:12 - Line 319:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-typescript text-sm text-gray-800">,
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 5</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 578:2 - Line 597:1), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 303:18 - Line 321:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-typescript text-sm text-gray-800">
        available_paints: mockPaints.slice(0, 5).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 4,
          allow_waste: false
        }
</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 63:4 - Line 74:2), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 28:4 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-typescript text-sm text-gray-800">,
    pigment_info: null,
    lightfastness_rating: null,
    transparency_rating: null,
    granulation_rating: null,
    staining_rating: null,
    color_temperature: null,
    color_bias: null,
    mixing_ratios: null,
    color_accuracy_verified: true,
    optical_properties_calibrated: true,
    times_used: 3</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 74:2 - Line 84:10), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 39:2 - Line 49:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(),
    purchase_date: new Date().toISOString(),
    notes: null,
    tags: [],
    archived: false,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  },
  {
    id: 'paint-3'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 98:3 - Line 109:2), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 28:4 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-typescript text-sm text-gray-800">,
    pigment_info: null,
    lightfastness_rating: null,
    transparency_rating: null,
    granulation_rating: null,
    staining_rating: null,
    color_temperature: null,
    color_bias: null,
    mixing_ratios: null,
    color_accuracy_verified: true,
    optical_properties_calibrated: true,
    times_used: 7</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 109:2 - Line 119:10), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 39:2 - Line 49:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(),
    purchase_date: new Date().toISOString(),
    notes: null,
    tags: [],
    archived: false,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  },
  {
    id: 'paint-4'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 133:2 - Line 144:2), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 28:4 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-typescript text-sm text-gray-800">,
    pigment_info: null,
    lightfastness_rating: null,
    transparency_rating: null,
    granulation_rating: null,
    staining_rating: null,
    color_temperature: null,
    color_bias: null,
    mixing_ratios: null,
    color_accuracy_verified: true,
    optical_properties_calibrated: true,
    times_used: 4</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 144:2 - Line 154:10), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 39:2 - Line 49:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(),
    purchase_date: new Date().toISOString(),
    notes: null,
    tags: [],
    archived: false,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  },
  {
    id: 'paint-5'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 168:4 - Line 179:2), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 28:4 - Line 39:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-typescript text-sm text-gray-800">,
    pigment_info: null,
    lightfastness_rating: null,
    transparency_rating: null,
    granulation_rating: null,
    staining_rating: null,
    color_temperature: null,
    color_bias: null,
    mixing_ratios: null,
    color_accuracy_verified: true,
    optical_properties_calibrated: true,
    times_used: 2</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 179:2 - Line 188:1), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 39:2 - Line 47:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-typescript text-sm text-gray-800">,
    last_used_at: new Date().toISOString(),
    purchase_date: new Date().toISOString(),
    notes: null,
    tags: [],
    archived: false,
    created_at: new Date().toISOString(),
    updated_at: new Date().toISOString()
  }
</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 240:13 - Line 255:2), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 161:11 - Line 319:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-typescript text-sm text-gray-800">.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 2</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 280:19 - Line 296:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 159:20 - Line 419:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-typescript text-sm text-gray-800">,
        target_color: targetColor,
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 50,
          min_volume_per_paint_ml: 0.5</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 323:2 - Line 337:3), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 440:16 - Line 174:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-typescript text-sm text-gray-800">
        available_paints: mockPaints.slice(0, 3).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 25</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 345:4 - Line 352:3), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 462:4 - Line 469:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-typescript text-sm text-gray-800">,
          time_limit_ms: 8000,
          quality_vs_speed: 'balanced'
        }
      });

      expect(result.success).toBe(true);
      expect(result.solution.total_volume_ml).toBeCloseTo(25</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 368:19 - Line 383:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 160:2 - Line 175:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-typescript text-sm text-gray-800">
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 0.1</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 423:19 - Line 445:25), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 159:20 - Line 324:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-typescript text-sm text-gray-800">,
        target_color: targetColor,
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 4,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 439:4 - Line 447:5), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 296:4 - Line 304:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-typescript text-sm text-gray-800">,
          max_paint_count: 4,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution',
          max_iterations: 200,
          time_limit_ms: 3000</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 447:18 - Line 455:5), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 510:25 - Line 518:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-typescript text-sm text-gray-800">
          quality_vs_speed: 'speed'
        }
      });

      const elapsed = Date.now() - startTime;

      expect(result.success).toBe(true);
      expect(elapsed).toBeLessThan(4000</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 472:19 - Line 493:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 159:20 - Line 323:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-typescript text-sm text-gray-800">,
        target_color: targetColor,
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 4,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 1.0</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 517:20 - Line 532:2), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 161:2 - Line 420:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-typescript text-sm text-gray-800">
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 50,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 1</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 556:13 - Line 565:25), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 499:2 - Line 508:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn56" onclick="toggleCodeBlock('cloneGroup56', 'expandBtn56', 'collapseBtn56')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup56"><code class="language-typescript text-sm text-gray-800">
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 5,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 577:2 - Line 591:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 161:11 - Line 175:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn57" onclick="toggleCodeBlock('cloneGroup57', 'expandBtn57', 'collapseBtn57')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup57"><code class="language-typescript text-sm text-gray-800">.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 150</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 592:2 - Line 602:2), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 560:2 - Line 570:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn58" onclick="toggleCodeBlock('cloneGroup58', 'expandBtn58', 'collapseBtn58')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup58"><code class="language-typescript text-sm text-gray-800">,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution',
          max_iterations: 100,
          time_limit_ms: 5000,
          quality_vs_speed: 'balanced'
        }
      });</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 614:2 - Line 633:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 212:2 - Line 259:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn59" onclick="toggleCodeBlock('cloneGroup59', 'expandBtn59', 'collapseBtn59')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup59"><code class="language-typescript text-sm text-gray-800">).map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 2,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 629:2 - Line 641:3), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 560:2 - Line 573:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn60" onclick="toggleCodeBlock('cloneGroup60', 'expandBtn60', 'collapseBtn60')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup60"><code class="language-typescript text-sm text-gray-800">,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution',
          max_iterations: 100,
          time_limit_ms: 5000,
          quality_vs_speed: 'balanced'
        }
      })).rejects.toThrow();
    });
  </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 647:5 - Line 669:4), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 487:5 - Line 566:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn61" onclick="toggleCodeBlock('cloneGroup61', 'expandBtn61', 'collapseBtn61')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup61"><code class="language-typescript text-sm text-gray-800"> },
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 5,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution',
          max_iterations: 150</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 667:4 - Line 676:16), src/lib/optimization/__tests__/differential-evolution.test.ts (Line 343:4 - Line 352:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn62" onclick="toggleCodeBlock('cloneGroup62', 'expandBtn62', 'collapseBtn62')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup62"><code class="language-typescript text-sm text-gray-800">,
          algorithm: 'differential_evolution',
          max_iterations: 150,
          time_limit_ms: 8000,
          quality_vs_speed: 'balanced'
        }
      });

      expect(result.success).toBe(true);
      expect(result.quality_metrics</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/optimization/__tests__/differential-evolution.test.ts (Line 686:5 - Line 710:11), src/lib/optimization/__tests__/tpe-hybrid.test.ts (Line 487:5 - Line 305:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn63" onclick="toggleCodeBlock('cloneGroup63', 'expandBtn63', 'collapseBtn63')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup63"><code class="language-typescript text-sm text-gray-800"> },
        available_paints: mockPaints.map(paint =&gt; ({
          id: paint.id,
          name: paint.name,
          brand: paint.brand,
          lab_l: paint.lab_l,
          lab_a: paint.lab_a,
          lab_b: paint.lab_b,
          volume_ml: paint.volume_ml,
          cost_per_ml: paint.cost_per_ml,
          finish_type: paint.finish_type,
          optical_properties_calibrated: paint.optical_properties_calibrated || false
        })),
        volume_constraints: {
          total_volume_ml: 100,
          min_volume_per_paint_ml: 1.0,
          max_paint_count: 4,
          allow_waste: false
        },
        optimization_config: {
          target_delta_e: 2.0,
          algorithm: 'differential_evolution',
          max_iterations: 200,
          time_limit_ms: 10000,
          quality_vs_speed: 'balanced'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 77:6 - Line 84:7), src/lib/database/repositories/enhanced-paint-repository.ts (Line 39:2 - Line 46:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn64" onclick="toggleCodeBlock('cloneGroup64', 'expandBtn64', 'collapseBtn64')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup64"><code class="language-typescript text-sm text-gray-800">)
        .single();

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 81:2 - Line 90:22), src/lib/database/repositories/enhanced-paint-repository.ts (Line 48:2 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn65" onclick="toggleCodeBlock('cloneGroup65', 'expandBtn65', 'collapseBtn65')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup65"><code class="language-typescript text-sm text-gray-800">;
      }

      return { data, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to get paint'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 187:7 - Line 193:23), src/lib/database/repositories/enhanced-paint-repository.ts (Line 51:2 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn66" onclick="toggleCodeBlock('cloneGroup66', 'expandBtn66', 'collapseBtn66')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup66"><code class="language-typescript text-sm text-gray-800">};
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to get paints'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 227:7 - Line 235:49), src/lib/database/repositories/enhanced-paint-repository.ts (Line 38:2 - Line 46:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn67" onclick="toggleCodeBlock('cloneGroup67', 'expandBtn67', 'collapseBtn67')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup67"><code class="language-typescript text-sm text-gray-800">)
        .select()
        .single();

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      // Update collection stats if collection changed</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 242:2 - Line 251:25), src/lib/database/repositories/enhanced-paint-repository.ts (Line 48:2 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn68" onclick="toggleCodeBlock('cloneGroup68', 'expandBtn68', 'collapseBtn68')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup68"><code class="language-typescript text-sm text-gray-800">
      }

      return { data, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to update paint'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 266:7 - Line 272:56), src/lib/database/repositories/enhanced-paint-repository.ts (Line 40:2 - Line 46:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn69" onclick="toggleCodeBlock('cloneGroup69', 'expandBtn69', 'collapseBtn69')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup69"><code class="language-typescript text-sm text-gray-800">);

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      // Update collection stats if paint was in a collection</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 277:5 - Line 283:25), src/lib/database/repositories/enhanced-paint-repository.ts (Line 51:5 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn70" onclick="toggleCodeBlock('cloneGroup70', 'expandBtn70', 'collapseBtn70')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup70"><code class="language-typescript text-sm text-gray-800">, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to delete paint'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 301:2 - Line 312:27), src/lib/database/repositories/enhanced-paint-repository.ts (Line 224:2 - Line 46:70)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn71" onclick="toggleCodeBlock('cloneGroup71', 'expandBtn71', 'collapseBtn71')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup71"><code class="language-typescript text-sm text-gray-800">
        })
        .eq('id', paintId)
        .eq('user_id', userId)
        .select()
        .single();

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      // Update collection stats</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 314:5 - Line 323:26), src/lib/database/repositories/enhanced-paint-repository.ts (Line 48:10 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn72" onclick="toggleCodeBlock('cloneGroup72', 'expandBtn72', 'collapseBtn72')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup72"><code class="language-typescript text-sm text-gray-800">.collection_id);
      }

      return { data, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to archive paint'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 341:2 - Line 347:2), src/lib/database/repositories/enhanced-paint-repository.ts (Line 40:2 - Line 84:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn73" onclick="toggleCodeBlock('cloneGroup73', 'expandBtn73', 'collapseBtn73')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup73"><code class="language-typescript text-sm text-gray-800">);

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data:</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 347:2 - Line 353:35), src/lib/database/repositories/enhanced-paint-repository.ts (Line 51:5 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn74" onclick="toggleCodeBlock('cloneGroup74', 'expandBtn74', 'collapseBtn74')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup74"><code class="language-typescript text-sm text-gray-800">, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to search paints by color'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 368:10 - Line 381:39), src/lib/database/repositories/enhanced-paint-repository.ts (Line 340:6 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn75" onclick="toggleCodeBlock('cloneGroup75', 'expandBtn75', 'collapseBtn75')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup75"><code class="language-typescript text-sm text-gray-800">
      });

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data: data || [], error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to get mixing recommendations'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 394:11 - Line 401:6), src/lib/database/repositories/enhanced-paint-repository.ts (Line 340:6 - Line 347:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn76" onclick="toggleCodeBlock('cloneGroup76', 'expandBtn76', 'collapseBtn76')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup76"><code class="language-typescript text-sm text-gray-800">
      });

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data: data || false</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 401:6 - Line 407:31), src/lib/database/repositories/enhanced-paint-repository.ts (Line 51:5 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn77" onclick="toggleCodeBlock('cloneGroup77', 'expandBtn77', 'collapseBtn77')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup77"><code class="language-typescript text-sm text-gray-800">, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to update paint usage'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 416:7 - Line 423:2), src/lib/database/repositories/enhanced-paint-repository.ts (Line 340:6 - Line 347:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn78" onclick="toggleCodeBlock('cloneGroup78', 'expandBtn78', 'collapseBtn78')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup78"><code class="language-typescript text-sm text-gray-800">
      });

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data: data?</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 423:5 - Line 429:27), src/lib/database/repositories/enhanced-paint-repository.ts (Line 51:5 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn79" onclick="toggleCodeBlock('cloneGroup79', 'expandBtn79', 'collapseBtn79')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup79"><code class="language-typescript text-sm text-gray-800">, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to get user stats'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 451:17 - Line 457:19), src/lib/database/repositories/enhanced-paint-repository.ts (Line 292:7 - Line 298:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn80" onclick="toggleCodeBlock('cloneGroup80', 'expandBtn80', 'collapseBtn80')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup80"><code class="language-typescript text-sm text-gray-800">?: string
  ): Promise&lt;DatabaseResponse&lt;EnhancedPaintRow&gt;&gt; {
    try {
      const { data, error } = await this.supabase
        .from(ENHANCED_PAINT_TABLE)
        .update({
          optical_properties</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 460:17 - Line 478:38), src/lib/database/repositories/enhanced-paint-repository.ts (Line 300:7 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn81" onclick="toggleCodeBlock('cloneGroup81', 'expandBtn81', 'collapseBtn81')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup81"><code class="language-typescript text-sm text-gray-800">,
          updated_at: new Date().toISOString()
        })
        .eq('id', paintId)
        .eq('user_id', userId)
        .select()
        .single();

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data, error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to update optical properties'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 509:2 - Line 518:1), src/lib/database/repositories/enhanced-paint-repository.ts (Line 264:2 - Line 84:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn82" onclick="toggleCodeBlock('cloneGroup82', 'expandBtn82', 'collapseBtn82')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup82"><code class="language-typescript text-sm text-gray-800">)
        .eq('id', paintId)
        .eq('user_id', userId);

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return {
</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 522:5 - Line 529:34), src/lib/database/repositories/enhanced-paint-repository.ts (Line 186:2 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn83" onclick="toggleCodeBlock('cloneGroup83', 'expandBtn83', 'collapseBtn83')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup83"><code class="language-typescript text-sm text-gray-800">
      };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to verify color accuracy'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 540:2 - Line 546:1), src/lib/database/repositories/enhanced-paint-repository.ts (Line 218:1 - Line 223:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn84" onclick="toggleCodeBlock('cloneGroup84', 'expandBtn84', 'collapseBtn84')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup84"><code class="language-typescript text-sm text-gray-800">
      const { data, error } = await this.supabase
        .from(ENHANCED_PAINT_TABLE)
        .update({
          ...updates,
          updated_at: new Date().toISOString()
</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/repositories/enhanced-paint-repository.ts (Line 549:7 - Line 561:31), src/lib/database/repositories/enhanced-paint-repository.ts (Line 40:7 - Line 57:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn85" onclick="toggleCodeBlock('cloneGroup85', 'expandBtn85', 'collapseBtn85')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup85"><code class="language-typescript text-sm text-gray-800">();

      if (error) {
        return { data: null, error: { code: error.code, message: error.message } };
      }

      return { data: data || [], error: null };
    } catch (err) {
      return {
        data: null,
        error: {
          code: 'UNKNOWN_ERROR',
          message: err instanceof Error ? err.message : 'Failed to bulk update paints'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 144:2 - Line 150:55), src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 59:7 - Line 65:49)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn86" onclick="toggleCodeBlock('cloneGroup86', 'expandBtn86', 'collapseBtn86')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup86"><code class="language-typescript text-sm text-gray-800">reflectanceSpectrum.forEach(r =&gt; {
        expect(r).toBeGreaterThanOrEqual(0);
        expect(r).toBeLessThanOrEqual(1);
        expect(Number.isFinite(r)).toBe(true);
      });

      // Should show characteristics of all three components</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 393:2 - Line 399:5), src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 365:1 - Line 372:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn87" onclick="toggleCodeBlock('cloneGroup87', 'expandBtn87', 'collapseBtn87')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup87"><code class="language-typescript text-sm text-gray-800">
      mixture.reflectanceSpectrum.forEach(r =&gt; {
        expect(Number.isFinite(r)).toBe(true);
        expect(r).toBeGreaterThanOrEqual(0);
        expect(r).toBeLessThanOrEqual(1);
      });
    </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 454:9 - Line 459:5), src/lib/color-science/__tests__/kubelka-munk-enhanced.test.ts (Line 59:20 - Line 65:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn88" onclick="toggleCodeBlock('cloneGroup88', 'expandBtn88', 'collapseBtn88')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup88"><code class="language-typescript text-sm text-gray-800">.forEach(r =&gt; {
        expect(r).toBeGreaterThanOrEqual(0);
        expect(r).toBeLessThanOrEqual(1);
        expect(Number.isFinite(r)).toBe(true);
      });
    </code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/sessions/route.ts (Line 146:27 - Line 160:5), src/app/api/sessions/[id]/route.ts (Line 64:21 - Line 79:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn89" onclick="toggleCodeBlock('cloneGroup89', 'expandBtn89', 'collapseBtn89')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup89"><code class="language-typescript text-sm text-gray-800">,
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    if (error instanceof Error) {
      if (error.message === 'User not authenticated') {
        const errorResponse: ErrorResponse = {
          error: 'AUTHENTICATION_ERROR',
          message: 'Authentication required',
        }
        return NextResponse.json(errorResponse, { status: 401 })
      }
    </code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/sessions/route.ts (Line 186:17 - Line 194:8), src/app/api/sessions/route.ts (Line 178:13 - Line 186:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn90" onclick="toggleCodeBlock('cloneGroup90', 'expandBtn90', 'collapseBtn90')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup90"><code class="language-typescript text-sm text-gray-800">: z.object({
        hex: z.string().regex(/^#[0-9A-Fa-f]{6}$/, 'Invalid hex color format'),
        lab: z.object({
          l: z.number().min(0).max(100),
          a: z.number().min(-128).max(127),
          b: z.number().min(-128).max(127),
        }),
      }).optional(),
      delta_e</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/sessions/route.ts (Line 235:26 - Line 255:2), src/app/api/sessions/[id]/route.ts (Line 115:24 - Line 79:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn91" onclick="toggleCodeBlock('cloneGroup91', 'expandBtn91', 'collapseBtn91')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup91"><code class="language-typescript text-sm text-gray-800">, error)

    if (error instanceof z.ZodError) {
      const errorResponse: ErrorResponse = {
        error: 'VALIDATION_ERROR',
        message: 'Invalid request data',
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    if (error instanceof Error) {
      if (error.message === 'User not authenticated') {
        const errorResponse: ErrorResponse = {
          error: 'AUTHENTICATION_ERROR',
          message: 'Authentication required',
        }
        return NextResponse.json(errorResponse, { status: 401 })
      }

      if (error.message.</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/sessions/route.ts (Line 269:2 - Line 284:2), src/app/api/sessions/[id]/route.ts (Line 209:2 - Line 247:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn92" onclick="toggleCodeBlock('cloneGroup92', 'expandBtn92', 'collapseBtn92')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup92"><code class="language-typescript text-sm text-gray-800">
}

export async function PUT() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'PUT method not supported' },
    { status: 405 }
  )
}

export async function DELETE() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'DELETE method not supported' },
    { status: 405 }
  )
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/ratio-predict/route.ts (Line 81:8 - Line 89:26), src/app/api/image/extract-color/route.ts (Line 145:2 - Line 153:34)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn93" onclick="toggleCodeBlock('cloneGroup93', 'expandBtn93', 'collapseBtn93')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup93"><code class="language-typescript text-sm text-gray-800">
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json()

    // Validate request
    const validatedData = RatioPredictRequestSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/ratio-predict/route.ts (Line 157:26 - Line 170:45), src/app/api/sessions/[id]/route.ts (Line 115:24 - Line 221:37)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn94" onclick="toggleCodeBlock('cloneGroup94', 'expandBtn94', 'collapseBtn94')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup94"><code class="language-typescript text-sm text-gray-800">, error)

    if (error instanceof z.ZodError) {
      const errorResponse: ErrorResponse = {
        error: 'VALIDATION_ERROR',
        message: 'Invalid request data',
        details: error.errors,
      }
      return NextResponse.json(errorResponse, { status: 400 })
    }

    const errorResponse: ErrorResponse = {
      error: 'INTERNAL_ERROR',
      message: 'Failed to process ratio prediction request'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/ratio-predict/route.ts (Line 170:45 - Line 196:2), src/app/api/image/extract-color/route.ts (Line 221:37 - Line 247:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn95" onclick="toggleCodeBlock('cloneGroup95', 'expandBtn95', 'collapseBtn95')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup95"><code class="language-typescript text-sm text-gray-800">,
    }
    return NextResponse.json(errorResponse, { status: 500 })
  }
}

// Handle unsupported methods
export async function GET() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'GET method not supported' },
    { status: 405 }
  )
}

export async function PUT() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'PUT method not supported' },
    { status: 405 }
  )
}

export async function DELETE() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'DELETE method not supported' },
    { status: 405 }
  )
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 29:2 - Line 39:8), src/app/api/collections/[id]/route.ts (Line 19:31 - Line 30:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn96" onclick="toggleCodeBlock('cloneGroup96', 'expandBtn96', 'collapseBtn96')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup96"><code class="language-typescript text-sm text-gray-800">);

async function getCurrentUser(supabase: any) {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) {
    throw new Error('Unauthorized');
  }
  return user;
}

export async function GET(request</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 74:11 - Line 90:11), src/app/api/paints/[id]/route.ts (Line 29:3 - Line 121:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn97" onclick="toggleCodeBlock('cloneGroup97', 'expandBtn97', 'collapseBtn97')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup97"><code class="language-typescript text-sm text-gray-800">);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'NOT_FOUND' ? 404 : 500 }
      );
    }

    return NextResponse.json({
      data: result.data,
      pagination</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 99:25 - Line 106:27), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn98" onclick="toggleCodeBlock('cloneGroup98', 'expandBtn98', 'collapseBtn98')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup98"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid query parameters'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 106:27 - Line 128:5), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 88:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn99" onclick="toggleCodeBlock('cloneGroup99', 'expandBtn99', 'collapseBtn99')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup99"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function POST</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 142:10 - Line 152:19), src/app/api/paints/[id]/route.ts (Line 29:3 - Line 39:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn100" onclick="toggleCodeBlock('cloneGroup100', 'expandBtn100', 'collapseBtn100')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup100"><code class="language-typescript text-sm text-gray-800">);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: result.error.code === 'VALIDATION_ERROR'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 168:26 - Line 175:21), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn101" onclick="toggleCodeBlock('cloneGroup101', 'expandBtn101', 'collapseBtn101')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup101"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid paint data'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 175:21 - Line 197:28), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 88:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn102" onclick="toggleCodeBlock('cloneGroup102', 'expandBtn102', 'collapseBtn102')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup102"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

// Bulk operations endpoint</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 198:4 - Line 204:5), src/app/api/paints/route.ts (Line 128:5 - Line 135:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn103" onclick="toggleCodeBlock('cloneGroup103', 'expandBtn103', 'collapseBtn103')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup103"><code class="language-typescript text-sm text-gray-800">(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const body = await request.json();
    </code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 230:8 - Line 245:7), src/app/api/paints/[id]/route.ts (Line 29:3 - Line 343:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn104" onclick="toggleCodeBlock('cloneGroup104', 'expandBtn104', 'collapseBtn104')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup104"><code class="language-typescript text-sm text-gray-800">);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    return NextResponse.json({
      data: result</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/paints/route.ts (Line 253:2 - Line 269:2), src/app/api/paints/[id]/route.ts (Line 72:2 - Line 158:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn105" onclick="toggleCodeBlock('cloneGroup105', 'expandBtn105', 'collapseBtn105')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup105"><code class="language-typescript text-sm text-gray-800">

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function DELETE()</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 59:2 - Line 70:39), src/app/api/paints/route.ts (Line 28:6 - Line 15:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn106" onclick="toggleCodeBlock('cloneGroup106', 'expandBtn106', 'collapseBtn106')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup106"><code class="language-typescript text-sm text-gray-800">)
});

async function getCurrentUser(supabase: any) {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) {
    throw new Error('Unauthorized');
  }
  return user;
}

// Global optimization client instance</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 77:2 - Line 86:12), src/app/api/paints/route.ts (Line 125:2 - Line 204:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn107" onclick="toggleCodeBlock('cloneGroup107', 'expandBtn107', 'collapseBtn107')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup107"><code class="language-typescript text-sm text-gray-800">
}

export async function POST(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const body = await request.json();
    const requestData</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 292:28 - Line 299:31), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn108" onclick="toggleCodeBlock('cloneGroup108', 'expandBtn108', 'collapseBtn108')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup108"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid optimization request'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 299:31 - Line 315:22), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 82:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn109" onclick="toggleCodeBlock('cloneGroup109', 'expandBtn109', 'collapseBtn109')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup109"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Optimization failed'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 318:2 - Line 326:6), src/app/api/paints/route.ts (Line 36:2 - Line 44:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn110" onclick="toggleCodeBlock('cloneGroup110', 'expandBtn110', 'collapseBtn110')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup110"><code class="language-typescript text-sm text-gray-800">
}

export async function GET(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/optimize/route.ts (Line 375:27 - Line 389:2), src/app/api/paints/route.ts (Line 253:25 - Line 86:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn111" onclick="toggleCodeBlock('cloneGroup111', 'expandBtn111', 'collapseBtn111')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup111"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 4:4 - Line 11:18), src/app/api/collections/[id]/route.ts (Line 4:4 - Line 11:28)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn112" onclick="toggleCodeBlock('cloneGroup112', 'expandBtn112', 'collapseBtn112')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup112"><code class="language-typescript text-sm text-gray-800">

import { NextRequest, NextResponse } from 'next/server';
import { createServerSupabaseClient } from '@/lib/database/supabase-client';
import { EnhancedPaintRepository } from '@/lib/database/repositories/enhanced-paint-repository';
import { z } from 'zod';

const QueryParamsSchema</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 8:56 - Line 14:13), src/app/api/paints/route.ts (Line 10:32 - Line 16:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn113" onclick="toggleCodeBlock('cloneGroup113', 'expandBtn113', 'collapseBtn113')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup113"><code class="language-typescript text-sm text-gray-800">;
import { z } from 'zod';

const QueryParamsSchema = z.object({
  page: z.coerce.number().min(1).default(1),
  limit: z.coerce.number().min(1).max(100).default(20),
  sort_field: z.enum(['created_at'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 35:15 - Line 40:17), src/app/api/mixing-history/route.ts (Line 30:13 - Line 35:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn114" onclick="toggleCodeBlock('cloneGroup114', 'expandBtn114', 'collapseBtn114')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup114"><code class="language-typescript text-sm text-gray-800">: z.object({
    L: z.number().min(0).max(100),
    a: z.number().min(-128).max(127),
    b: z.number().min(-128).max(127)
  }),
  delta_e_achieved</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 61:2 - Line 80:5), src/app/api/optimize/route.ts (Line 59:2 - Line 48:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn115" onclick="toggleCodeBlock('cloneGroup115', 'expandBtn115', 'collapseBtn115')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup115"><code class="language-typescript text-sm text-gray-800">).optional()
});

async function getCurrentUser(supabase: any) {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) {
    throw new Error('Unauthorized');
  }
  return user;
}

export async function GET(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Parse query parameters
    const url = new URL(request.url);
    const queryParams = Object.fromEntries(url.searchParams.entries());
    </code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 121:11 - Line 129:17), src/app/api/paints/route.ts (Line 66:18 - Line 74:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn116" onclick="toggleCodeBlock('cloneGroup116', 'expandBtn116', 'collapseBtn116')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup116"><code class="language-typescript text-sm text-gray-800"> = {
      page: parsedParams.page,
      limit: parsedParams.limit,
      sort_field: parsedParams.sort_field,
      sort_direction: parsedParams.sort_direction
    };

    const repository = new EnhancedPaintRepository(supabase);
    const result = await repository.getMixingHistory</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 129:17 - Line 143:40), src/app/api/paints/route.ts (Line 74:14 - Line 342:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn117" onclick="toggleCodeBlock('cloneGroup117', 'expandBtn117', 'collapseBtn117')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup117"><code class="language-typescript text-sm text-gray-800">(user.id, filters, pagination);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    // Calculate analytics for current page</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 172:33 - Line 207:12), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 204:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn118" onclick="toggleCodeBlock('cloneGroup118', 'expandBtn118', 'collapseBtn118')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup118"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid query parameters',
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const body = await request.json();
    const sessionData</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 213:2 - Line 227:33), src/app/api/paints/[id]/route.ts (Line 29:3 - Line 342:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn119" onclick="toggleCodeBlock('cloneGroup119', 'expandBtn119', 'collapseBtn119')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup119"><code class="language-typescript text-sm text-gray-800">);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    // Update paint usage statistics</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 251:34 - Line 258:30), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn120" onclick="toggleCodeBlock('cloneGroup120', 'expandBtn120', 'collapseBtn120')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup120"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid mixing session data'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 258:30 - Line 280:44), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 88:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn121" onclick="toggleCodeBlock('cloneGroup121', 'expandBtn121', 'collapseBtn121')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup121"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

// Analytics endpoint for dashboard metrics</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 280:44 - Line 286:4), src/app/api/paints/route.ts (Line 197:28 - Line 203:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn122" onclick="toggleCodeBlock('cloneGroup122', 'expandBtn122', 'collapseBtn122')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup122"><code class="language-typescript text-sm text-gray-800">
export async function PUT(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const url</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 281:4 - Line 287:14), src/app/api/optimize/route.ts (Line 321:4 - Line 327:15)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn123" onclick="toggleCodeBlock('cloneGroup123', 'expandBtn123', 'collapseBtn123')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup123"><code class="language-typescript text-sm text-gray-800">(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const url = new URL(request.url);
    const analyticsType</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/mixing-history/route.ts (Line 327:43 - Line 337:27), src/app/api/paints/route.ts (Line 253:25 - Line 82:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn124" onclick="toggleCodeBlock('cloneGroup124', 'expandBtn124', 'collapseBtn124')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup124"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Analytics request failed'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/color-match/route.ts (Line 86:13 - Line 92:22), src/app/api/color-match/route.ts (Line 61:11 - Line 67:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn125" onclick="toggleCodeBlock('cloneGroup125', 'expandBtn125', 'collapseBtn125')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup125"><code class="language-typescript text-sm text-gray-800">.map(ratio =&gt; ({
      ...ratio,
      volume_ml: (ratio.percentage / 100) * totalVolume,
      paint_properties: PAINT_DATABASE.find(p =&gt; p.id === ratio.paint_id)!,
    }))

    if (simpleRatiosWithProps</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/color-match/route.ts (Line 114:13 - Line 120:22), src/app/api/color-match/route.ts (Line 61:11 - Line 67:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn126" onclick="toggleCodeBlock('cloneGroup126', 'expandBtn126', 'collapseBtn126')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup126"><code class="language-typescript text-sm text-gray-800">.map(ratio =&gt; ({
      ...ratio,
      volume_ml: (ratio.percentage / 100) * totalVolume,
      paint_properties: PAINT_DATABASE.find(p =&gt; p.id === ratio.paint_id)!,
    }))

    if (chromaRatiosWithProps</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/color-match/route.ts (Line 243:43 - Line 269:2), src/app/api/image/extract-color/route.ts (Line 221:37 - Line 247:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn127" onclick="toggleCodeBlock('cloneGroup127', 'expandBtn127', 'collapseBtn127')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup127"><code class="language-typescript text-sm text-gray-800">,
    }
    return NextResponse.json(errorResponse, { status: 500 })
  }
}

// Handle unsupported methods
export async function GET() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'GET method not supported' },
    { status: 405 }
  )
}

export async function PUT() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'PUT method not supported' },
    { status: 405 }
  )
}

export async function DELETE() {
  return NextResponse.json(
    { error: 'METHOD_NOT_ALLOWED', message: 'DELETE method not supported' },
    { status: 405 }
  )
}</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 4:4 - Line 14:13), src/app/api/collections/[id]/route.ts (Line 4:4 - Line 16:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn128" onclick="toggleCodeBlock('cloneGroup128', 'expandBtn128', 'collapseBtn128')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup128"><code class="language-typescript text-sm text-gray-800">

import { NextRequest, NextResponse } from 'next/server';
import { createServerSupabaseClient } from '@/lib/database/supabase-client';
import { EnhancedPaintRepository } from '@/lib/database/repositories/enhanced-paint-repository';
import { z } from 'zod';

const QueryParamsSchema = z.object({
  page: z.coerce.number().min(1).default(1),
  limit: z.coerce.number().min(1).max(100).default(20),
  sort_field: z.enum(['name', 'created_at'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 24:2 - Line 29:5), src/lib/database/models/enhanced-paint.ts (Line 118:2 - Line 123:12)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn129" onclick="toggleCodeBlock('cloneGroup129', 'expandBtn129', 'collapseBtn129')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup129"><code class="language-typescript text-sm text-gray-800">
  name: z.string().min(1).max(255),
  description: z.string().max(1000).optional(),
  color_space: z.enum(['sRGB', 'Adobe_RGB', 'ProPhoto_RGB', 'Lab']).default('sRGB'),
  is_default: z.boolean().default(false),
  tags</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 30:2 - Line 37:2), src/app/api/collections/[id]/route.ts (Line 9:6 - Line 17:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn130" onclick="toggleCodeBlock('cloneGroup130', 'expandBtn130', 'collapseBtn130')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup130"><code class="language-typescript text-sm text-gray-800">;

const PaintCollectionUpdateSchema = z.object({
  name: z.string().min(1).max(255).optional(),
  description: z.string().max(1000).optional(),
  color_space: z.enum(['sRGB', 'Adobe_RGB', 'ProPhoto_RGB', 'Lab']).optional(),
  is_default: z.boolean().optional(),
  tags: z.array(z.string()).optional(),</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 38:9 - Line 61:13), src/app/api/mixing-history/route.ts (Line 61:16 - Line 84:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn131" onclick="toggleCodeBlock('cloneGroup131', 'expandBtn131', 'collapseBtn131')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup131"><code class="language-typescript text-sm text-gray-800">: z.boolean().optional()
});

async function getCurrentUser(supabase: any) {
  const { data: { user }, error } = await supabase.auth.getUser();
  if (error || !user) {
    throw new Error('Unauthorized');
  }
  return user;
}

export async function GET(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    // Parse query parameters
    const url = new URL(request.url);
    const queryParams = Object.fromEntries(url.searchParams.entries());
    const parsedParams = QueryParamsSchema.parse(queryParams);

    // Build filters
    const filters: any = {
      archived: parsedParams</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 77:6 - Line 88:19), src/app/api/mixing-history/route.ts (Line 118:16 - Line 74:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn132" onclick="toggleCodeBlock('cloneGroup132', 'expandBtn132', 'collapseBtn132')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup132"><code class="language-typescript text-sm text-gray-800">;
    }

    const pagination = {
      page: parsedParams.page,
      limit: parsedParams.limit,
      sort_field: parsedParams.sort_field,
      sort_direction: parsedParams.sort_direction
    };

    const repository = new EnhancedPaintRepository(supabase);
    const result = await repository.getUserCollections</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 88:19 - Line 102:32), src/app/api/paints/route.ts (Line 74:14 - Line 342:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn133" onclick="toggleCodeBlock('cloneGroup133', 'expandBtn133', 'collapseBtn133')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup133"><code class="language-typescript text-sm text-gray-800">(user.id, filters, pagination);

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    // Calculate summary statistics</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 121:18 - Line 128:30), src/app/api/mixing-history/route.ts (Line 165:15 - Line 172:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn134" onclick="toggleCodeBlock('cloneGroup134', 'expandBtn134', 'collapseBtn134')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup134"><code class="language-typescript text-sm text-gray-800">: result.pagination.total_count,
        filters_applied: Object.keys(filters).filter(key =&gt; filters[key] !== undefined).length,
        query_timestamp: new Date().toISOString()
      }
    });

  } catch (error) {
    console.error('GET /api/collections error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 128:30 - Line 163:15), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 204:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn135" onclick="toggleCodeBlock('cloneGroup135', 'expandBtn135', 'collapseBtn135')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup135"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid query parameters',
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const body = await request.json();
    const collectionData</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 168:11 - Line 175:2), src/app/api/collections/[id]/route.ts (Line 174:5 - Line 181:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn136" onclick="toggleCodeBlock('cloneGroup136', 'expandBtn136', 'collapseBtn136')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup136"><code class="language-typescript text-sm text-gray-800">) {
      const existingDefault = await repository.getUserCollections(
        user.id,
        { is_default: true, archived: false },
        { page: 1, limit: 1 }
      );

      if (existingDefault.data &amp;&amp; existingDefault.data.length &gt; 0)</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 212:2 - Line 228:1), src/app/api/mixing-history/route.ts (Line 212:3 - Line 342:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn137" onclick="toggleCodeBlock('cloneGroup137', 'expandBtn137', 'collapseBtn137')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup137"><code class="language-typescript text-sm text-gray-800">
    });

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    return NextResponse.json(
</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 223:7 - Line 232:14), src/app/api/paints/route.ts (Line 152:2 - Line 161:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn138" onclick="toggleCodeBlock('cloneGroup138', 'expandBtn138', 'collapseBtn138')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup138"><code class="language-typescript text-sm text-gray-800">: 500 }
      );
    }

    return NextResponse.json(
      {
        data: result.data,
        meta: {
          created_at: result.data?.created_at,
          collection_id</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 239:31 - Line 246:26), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn139" onclick="toggleCodeBlock('cloneGroup139', 'expandBtn139', 'collapseBtn139')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup139"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid collection data'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 246:26 - Line 268:35), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 88:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn140" onclick="toggleCodeBlock('cloneGroup140', 'expandBtn140', 'collapseBtn140')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup140"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

// Bulk operations for collections</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 268:35 - Line 275:15), src/app/api/paints/route.ts (Line 197:28 - Line 204:10)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn141" onclick="toggleCodeBlock('cloneGroup141', 'expandBtn141', 'collapseBtn141')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup141"><code class="language-typescript text-sm text-gray-800">
export async function PUT(request: NextRequest) {
  try {
    const supabase = createServerSupabaseClient();
    const user = await getCurrentUser(supabase);

    const body = await request.json();
    const { collection_ids</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 332:9 - Line 350:10), src/app/api/collections/[id]/route.ts (Line 327:18 - Line 247:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn142" onclick="toggleCodeBlock('cloneGroup142', 'expandBtn142', 'collapseBtn142')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup142"><code class="language-typescript text-sm text-gray-800">);
    }

    if (result.error) {
      return NextResponse.json(
        {
          error: {
            code: result.error.code,
            message: result.error.message
          }
        },
        { status: 500 }
      );
    }

    return NextResponse.json({
      data: result.data,
      meta: {
        operation</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 357:30 - Line 364:30), src/app/api/paints/[id]/route.ts (Line 59:30 - Line 66:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn143" onclick="toggleCodeBlock('cloneGroup143', 'expandBtn143', 'collapseBtn143')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup143"><code class="language-typescript text-sm text-gray-800">, error);

    if (error instanceof z.ZodError) {
      return NextResponse.json(
        {
          error: {
            code: 'VALIDATION_ERROR',
            message: 'Invalid bulk operation data'</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/api/collections/route.ts (Line 364:30 - Line 388:70), src/app/api/paints/[id]/route.ts (Line 66:19 - Line 271:60)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn144" onclick="toggleCodeBlock('cloneGroup144', 'expandBtn144', 'collapseBtn144')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup144"><code class="language-typescript text-sm text-gray-800">,
            details: error.errors
          }
        },
        { status: 400 }
      );
    }

    if (error instanceof Error &amp;&amp; error.message === 'Unauthorized') {
      return NextResponse.json(
        { error: { code: 'UNAUTHORIZED', message: 'Authentication required' } },
        { status: 401 }
      );
    }

    return NextResponse.json(
      { error: { code: 'INTERNAL_ERROR', message: 'Internal server error' } },
      { status: 500 }
    );
  }
}

export async function DELETE() {
  return NextResponse.json(
    { error: { code: 'METHOD_NOT_ALLOWED', message: 'Use DELETE /api/collections/[id] for individual collection deletion'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/utils/performance.ts (Line 361:2 - Line 370:46), src/lib/utils/performance.ts (Line 345:6 - Line 354:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn145" onclick="toggleCodeBlock('cloneGroup145', 'expandBtn145', 'collapseBtn145')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup145"><code class="language-typescript text-sm text-gray-800"> operation()
    performanceMonitor.endTimer(name, metadata)
    return result
  } catch (error) {
    performanceMonitor.endTimer(name, { ...metadata, error: true })
    throw error
  }
}

// API call wrapper with performance tracking</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/supabase/sessions.ts (Line 276:2 - Line 283:28), src/lib/supabase/sessions.ts (Line 205:10 - Line 212:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn146" onclick="toggleCodeBlock('cloneGroup146', 'expandBtn146', 'collapseBtn146')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup146"><code class="language-typescript text-sm text-gray-800">)
      .single()

    if (error) {
      if (error.code === 'PGRST116') {
        throw new Error('Session not found')
      }
      throw new Error(`Failed to update session: </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/supabase/sessions.ts (Line 411:2 - Line 419:4), src/lib/supabase/sessions.ts (Line 183:20 - Line 204:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn147" onclick="toggleCodeBlock('cloneGroup147', 'expandBtn147', 'collapseBtn147')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup147"><code class="language-typescript text-sm text-gray-800">&gt; {
    const user = await getCurrentUser()
    if (!user) {
      throw new Error('User not authenticated')
    }

    const { data, error } = await supabase
      .from('mixing_sessions')
      .select('*'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/services/enhanced-optimization-integration.ts (Line 303:18 - Line 309:2), src/lib/services/enhanced-optimization-integration.ts (Line 239:13 - Line 245:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn148" onclick="toggleCodeBlock('cloneGroup148', 'expandBtn148', 'collapseBtn148')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup148"><code class="language-typescript text-sm text-gray-800"> = await this.repository.getUserPaints(
      userId,
      {
        collection_id: request.collection_id,
        archived: false
      },
      { page: 1, limit: 1</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/services/enhanced-optimization-integration.ts (Line 436:18 - Line 441:15), src/lib/services/enhanced-optimization-integration.ts (Line 74:10 - Line 79:39)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn149" onclick="toggleCodeBlock('cloneGroup149', 'expandBtn149', 'collapseBtn149')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup149"><code class="language-typescript text-sm text-gray-800"> = Date.now();
    let enhancedResult: OptimizationResult | null = null;
    let legacyResult: LegacyMixingFormula | null = null;

    try {
      enhancedResult</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/mixing-optimization/differential-evolution.ts (Line 466:3 - Line 471:2), src/lib/mixing-optimization/differential-evolution.ts (Line 424:3 - Line 429:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn150" onclick="toggleCodeBlock('cloneGroup150', 'expandBtn150', 'collapseBtn150')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup150"><code class="language-typescript text-sm text-gray-800">] = indices.map(i =&gt; this.population.individuals[i].variables);
    const best = this.population.best_individual.variables;

    const trial: number[] = [];
    for (let j = 0; j &lt; this.availablePaints.length; j++) {
      trial.push(best[j] + this.config.F * (r1[j] - r2[j]) </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/middleware/error-handler.ts (Line 200:2 - Line 206:2), src/lib/middleware/error-handler.ts (Line 118:2 - Line 124:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn151" onclick="toggleCodeBlock('cloneGroup151', 'expandBtn151', 'collapseBtn151')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup151"><code class="language-typescript text-sm text-gray-800"> {
        issues: error.issues.map(issue =&gt; ({
          path: issue.path.join('.'),
          message: issue.message,
          code: issue.code,
        })),
      })</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/image-processing/canvas-utils.ts (Line 195:16 - Line 204:19), src/lib/image-processing/canvas-utils.ts (Line 153:48 - Line 162:44)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn152" onclick="toggleCodeBlock('cloneGroup152', 'expandBtn152', 'collapseBtn152')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup152"><code class="language-typescript text-sm text-gray-800">
    for (let i = 0; i &lt; data.length; i += 4) {
      // Skip transparent pixels
      if (data[i + 3] &lt; 128) continue

      const r = data[i]
      const g = data[i + 1]
      const b = data[i + 2]

      // Quantize colors</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/image-processing/canvas-utils.ts (Line 204:19 - Line 211:7), src/lib/image-processing/canvas-utils.ts (Line 162:44 - Line 169:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn153" onclick="toggleCodeBlock('cloneGroup153', 'expandBtn153', 'collapseBtn153')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup153"><code class="language-typescript text-sm text-gray-800">
      const quantizedR = Math.floor(r / tolerance) * tolerance
      const quantizedG = Math.floor(g / tolerance) * tolerance
      const quantizedB = Math.floor(b / tolerance) * tolerance

      const colorKey = `${quantizedR},${quantizedG},${quantizedB}`
      colorMap.set(colorKey, (colorMap.get(colorKey) || 0) + 1)
      </code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/database.types.ts (Line 63:2 - Line 71:2), src/lib/database/database.types.ts (Line 20:11 - Line 28:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn154" onclick="toggleCodeBlock('cloneGroup154', 'expandBtn154', 'collapseBtn154')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup154"><code class="language-typescript text-sm text-gray-800">: string | null
          finish_type: 'matte' | 'satin' | 'semi_gloss' | 'gloss' | 'high_gloss'
          lab_color: Json
          rgb_color: Json
          hex_color: string
          optical_properties: Json
          volume_ml: number
          cost_per_ml: number
          viscosity?</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/database.types.ts (Line 113:2 - Line 142:14), src/lib/database/database.types.ts (Line 70:12 - Line 99:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn155" onclick="toggleCodeBlock('cloneGroup155', 'expandBtn155', 'collapseBtn155')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup155"><code class="language-typescript text-sm text-gray-800">: number
          viscosity?: number | null
          density_g_per_ml?: number | null
          mixing_compatibility?: Json
          mixing_restrictions?: Json
          drying_time_minutes?: number | null
          coverage_sqm_per_liter?: number | null
          delta_e_tolerance?: number
          color_stability_rating?: number
          lightfastness_rating?: number | null
          times_used?: number
          total_volume_mixed?: number
          last_used_at?: string | null
          color_accuracy_verified?: boolean
          optical_properties_calibrated?: boolean
          calibration_date?: string | null
          quality_control_notes?: string | null
          tags?: Json
          notes?: string | null
          purchase_date?: string | null
          expiry_date?: string | null
          supplier?: string | null
          created_at?: string
          updated_at?: string
          version?: number
          archived?: boolean
          archived_at?: string | null
          archived_reason?: string | null
        }
        Relationships</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/database.types.ts (Line 193:2 - Line 205:14), src/lib/database/database.types.ts (Line 178:5 - Line 190:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn156" onclick="toggleCodeBlock('cloneGroup156', 'expandBtn156', 'collapseBtn156')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup156"><code class="language-typescript text-sm text-gray-800">: string
          description?: string | null
          color_space?: 'sRGB' | 'Adobe_RGB' | 'ProPhoto_RGB' | 'Lab'
          is_default?: boolean
          paint_count?: number
          total_volume_ml?: number
          average_cost_per_ml?: number
          tags?: Json
          created_at?: string
          updated_at?: string
          archived?: boolean
        }
        Relationships</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/database.types.ts (Line 244:2 - Line 256:2), src/lib/database/database.types.ts (Line 217:3 - Line 229:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn157" onclick="toggleCodeBlock('cloneGroup157', 'expandBtn157', 'collapseBtn157')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup157"><code class="language-typescript text-sm text-gray-800">: string
          user_id: string
          target_color: Json
          achieved_color: Json
          delta_e_achieved: number
          paint_volumes: Json
          total_volume_ml: number
          mixing_time_minutes: number
          algorithm_used: string
          iterations_completed: number
          optimization_time_ms: number
          convergence_achieved: boolean
          color_accuracy_score?</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/database/database.types.ts (Line 282:2 - Line 297:14), src/lib/database/database.types.ts (Line 255:21 - Line 270:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn158" onclick="toggleCodeBlock('cloneGroup158', 'expandBtn158', 'collapseBtn158')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup158"><code class="language-typescript text-sm text-gray-800">: boolean
          color_accuracy_score?: number | null
          mixing_efficiency_score?: number | null
          cost_effectiveness_score?: number | null
          project_name?: string | null
          surface_type?: string | null
          application_method?: string | null
          environmental_conditions?: Json | null
          user_satisfaction_rating?: number | null
          notes?: string | null
          would_use_again?: boolean | null
          created_at?: string
          updated_at?: string
          archived?: boolean
        }
        Relationships</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/kubelka-munk-enhanced.ts (Line 479:1 - Line 484:3), src/lib/color-science/kubelka-munk-enhanced.ts (Line 385:44 - Line 390:32)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn159" onclick="toggleCodeBlock('cloneGroup159', 'expandBtn159', 'collapseBtn159')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup159"><code class="language-typescript text-sm text-gray-800">
  const a = (k + s) / s;
  const b = Math.sqrt(a * a - 1);
  const opacityInfinite = (a - b) / (a + b);

  if</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/delta-e-ciede2000.ts (Line 93:40 - Line 98:50), src/lib/color-science/lab-enhanced.ts (Line 209:28 - Line 214:22)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn160" onclick="toggleCodeBlock('cloneGroup160', 'expandBtn160', 'collapseBtn160')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup160"><code class="language-typescript text-sm text-gray-800">
  const c1 = Math.sqrt(lab1.a * lab1.a + lab1.b * lab1.b);
  const c2 = Math.sqrt(lab2.a * lab2.a + lab2.b * lab2.b);
  const cAvg = (c1 + c2) / 2;

  // Step 2: Calculate G factor for a* modification</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/color-science/delta-e-ciede2000.ts (Line 104:2 - Line 109:41), src/lib/color-science/lab-enhanced.ts (Line 221:29 - Line 226:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn161" onclick="toggleCodeBlock('cloneGroup161', 'expandBtn161', 'collapseBtn161')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup161"><code class="language-typescript text-sm text-gray-800">
  const c1Prime = Math.sqrt(a1Prime * a1Prime + lab1.b * lab1.b);
  const c2Prime = Math.sqrt(a2Prime * a2Prime + lab2.b * lab2.b);
  const cPrimeAvg = (c1Prime + c2Prime) / 2;

  // Step 4: Calculate modified hue angles</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/auth/supabase-server.ts (Line 62:25 - Line 82:2), src/lib/auth/supabase-server.ts (Line 31:28 - Line 51:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn162" onclick="toggleCodeBlock('cloneGroup162', 'expandBtn162', 'collapseBtn162')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup162"><code class="language-typescript text-sm text-gray-800">() {
  const cookieStore = await cookies()

  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL
  const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY

  if (!supabaseUrl || !supabaseAnonKey) {
    throw new Error('Missing Supabase environment variables')
  }

  return createServerClient&lt;Database&gt;(supabaseUrl, supabaseAnonKey, {
    cookies: {
      getAll() {
        return cookieStore.getAll()
      },
      setAll(cookiesToSet) {
        try {
          cookiesToSet.forEach(({ name, value, options }) =&gt;
            cookieStore.set(name, value, options)
          )
        } catch (</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/auth/supabase-client.ts (Line 111:13 - Line 119:21), src/lib/auth/supabase-server.ts (Line 116:28 - Line 124:28)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn163" onclick="toggleCodeBlock('cloneGroup163', 'expandBtn163', 'collapseBtn163')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup163"><code class="language-typescript text-sm text-gray-800">()

  const {
    data: { session },
    error
  } = await supabase.auth.getSession()

  if (error) {
    console.error('Get session error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/auth/supabase-client.ts (Line 132:13 - Line 140:18), src/lib/auth/supabase-server.ts (Line 144:28 - Line 152:25)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn164" onclick="toggleCodeBlock('cloneGroup164', 'expandBtn164', 'collapseBtn164')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup164"><code class="language-typescript text-sm text-gray-800">()

  const {
    data: { user },
    error
  } = await supabase.auth.getUser()

  if (error) {
    console.error('Get user error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/auth/supabase-client.ts (Line 202:13 - Line 210:23), src/lib/auth/supabase-server.ts (Line 229:25 - Line 237:30)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn165" onclick="toggleCodeBlock('cloneGroup165', 'expandBtn165', 'collapseBtn165')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup165"><code class="language-typescript text-sm text-gray-800">()

  const {
    data: { session },
    error
  } = await supabase.auth.exchangeCodeForSession(code)

  if (error) {
    console.error('Exchange code error:'</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/auth/rate-limit.ts (Line 104:5 - Line 111:40), src/lib/auth/rate-limit.ts (Line 59:2 - Line 66:65)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn166" onclick="toggleCodeBlock('cloneGroup166', 'expandBtn166', 'collapseBtn166')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup166"><code class="language-typescript text-sm text-gray-800"> {
  const now = Date.now()
  const windowStart = now - RATE_LIMIT_WINDOW_MS

  // Get existing record or create empty one
  const record = rateLimitCache.get(ipAddress) || { timestamps: [] }

  // Prune old timestamps and add new one</code></pre></div><div class="py-4"><p class="text-gray-600">src/lib/api/client.ts (Line 107:7 - Line 112:6), src/lib/api/client.ts (Line 96:8 - Line 101:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn167" onclick="toggleCodeBlock('cloneGroup167', 'expandBtn167', 'collapseBtn167')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup167"><code class="language-typescript text-sm text-gray-800">&lt;T&gt;(
  endpoint: string,
  body: unknown,
  signal?: AbortSignal
): Promise&lt;APIResponse&lt;T&gt;&gt; {
  return apiRequest&lt;T&gt;(endpoint, { method: 'PUT'</code></pre></div><div class="py-4"><p class="text-gray-600">src/types/types.ts (Line 273:14 - Line 280:63), src/types/types.ts (Line 266:17 - Line 273:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn193" onclick="toggleCodeBlock('cloneGroup193', 'expandBtn193', 'collapseBtn193')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup193"><code class="language-typescript text-sm text-gray-800"> {
  onChange?: (color: ColorValue) =&gt; void;
  onColorChange: (color: ColorValue) =&gt; void;
  disabled: boolean;
  className?: string;
}

// ==================== Hook Return Types ====================</code></pre></div><div class="py-4"><p class="text-gray-600">src/hooks/use-sessions.ts (Line 176:5 - Line 181:9), src/hooks/use-sessions.ts (Line 140:12 - Line 145:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn194" onclick="toggleCodeBlock('cloneGroup194', 'expandBtn194', 'collapseBtn194')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup194"><code class="language-typescript text-sm text-gray-800">&gt; =&gt; {
    setState(prev =&gt; ({ ...prev, error: null }))

    try {
      const response = await fetch(`/api/sessions/${sessionId}`, {
        method: 'DELETE'</code></pre></div><div class="py-4"><p class="text-gray-600">src/hooks/use-paint-colors.ts (Line 66:2 - Line 72:31), src/hooks/use-sessions.ts (Line 89:9 - Line 95:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn195" onclick="toggleCodeBlock('cloneGroup195', 'expandBtn195', 'collapseBtn195')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup195"><code class="language-typescript text-sm text-gray-800">,
      }))
    } catch (err) {
      setState(prev =&gt; ({
        ...prev,
        isLoading: false,
        error: err instanceof Error ? err.message : 'Failed to fetch paint colors'</code></pre></div><div class="py-4"><p class="text-gray-600">src/hooks/use-image-processing.ts (Line 159:15 - Line 164:26), src/hooks/use-image-processing.ts (Line 124:2 - Line 129:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn196" onclick="toggleCodeBlock('cloneGroup196', 'expandBtn196', 'collapseBtn196')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup196"><code class="language-typescript text-sm text-gray-800">
    } catch (err) {
      setState(prev =&gt; ({
        ...prev,
        isProcessing: false,
        error: err instanceof Error ? err.message : 'Failed to extract color'</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="javascript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">javascript</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="tsx-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">tsx</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">src/components/ui/color-picker.tsx (Line 316:2 - Line 329:9), src/components/ui/color-picker.tsx (Line 302:2 - Line 315:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn168" onclick="toggleCodeBlock('cloneGroup168', 'expandBtn168', 'collapseBtn168')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup168"><code class="language-tsx text-sm text-gray-800">*&lt;/label&gt;
            &lt;input
              type=&quot;number&quot;
              min=&quot;-128&quot;
              max=&quot;127&quot;
              step=&quot;0.1&quot;
              value={colorInputs.b}
              onChange={(e) =&gt; handleLABInput('b', e.target.value)}
              disabled={disabled}
              className=&quot;w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500&quot;
            /&gt;
            &lt;div className=&quot;text-xs text-gray-500 mt-1&quot;&gt;-128 to 127&lt;/div&gt;
          &lt;/div&gt;
        </code></pre></div><div class="py-4"><p class="text-gray-600">src/components/ui/color-picker.tsx (Line 347:6 - Line 359:5), src/components/ui/color-picker.tsx (Line 335:4 - Line 347:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn169" onclick="toggleCodeBlock('cloneGroup169', 'expandBtn169', 'collapseBtn169')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup169"><code class="language-tsx text-sm text-gray-800">&lt;/label&gt;
            &lt;input
              type=&quot;number&quot;
              min=&quot;0&quot;
              max=&quot;255&quot;
              value={colorInputs.g}
              onChange={(e) =&gt; handleRGBInput('g', e.target.value)}
              disabled={disabled}
              className=&quot;w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500&quot;
            /&gt;
          &lt;/div&gt;
          &lt;div&gt;
            &lt;label className=&quot;block text-sm font-medium text-gray-700 mb-1&quot;&gt;Blue</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/session-manager/SessionCard.tsx (Line 192:7 - Line 201:119), src/components/session-manager/SessionCard.tsx (Line 179:2 - Line 188:33)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn170" onclick="toggleCodeBlock('cloneGroup170', 'expandBtn170', 'collapseBtn170')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup170"><code class="language-tsx text-sm text-gray-800">&gt;
                    &lt;button
                      onClick={() =&gt; {
                        onEdit?.(session.id)
                        setIsMenuOpen(false)
                      }}
                      className=&quot;flex items-center gap-2 w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50&quot;
                    &gt;
                      &lt;svg className=&quot;w-4 h-4&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; viewBox=&quot;0 0 24 24&quot;&gt;
                        &lt;path strokeLinecap=&quot;round&quot; strokeLinejoin=&quot;round&quot; strokeWidth={2} d=&quot;M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/optimization/optimization-controls.tsx (Line 459:22 - Line 468:10), src/components/optimization/optimization-controls.tsx (Line 315:27 - Line 324:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn171" onclick="toggleCodeBlock('cloneGroup171', 'expandBtn171', 'collapseBtn171')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup171"><code class="language-tsx text-sm text-gray-800">}
          &lt;div className=&quot;space-y-3&quot;&gt;
            &lt;label className=&quot;flex items-center&quot;&gt;
              &lt;input
                type=&quot;checkbox&quot;
                checked={filters.available_only}
                onChange={(e) =&gt; handleFiltersChange({ available_only: e.target.checked })}
                className=&quot;mr-2&quot;
              /&gt;
              &lt;span className=&quot;text-sm&quot;&gt;Available</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/optimization/optimization-controls.tsx (Line 468:2 - Line 477:6), src/components/optimization/optimization-controls.tsx (Line 324:5 - Line 333:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn172" onclick="toggleCodeBlock('cloneGroup172', 'expandBtn172', 'collapseBtn172')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup172"><code class="language-tsx text-sm text-gray-800">&lt;/span&gt;
            &lt;/label&gt;
            &lt;label className=&quot;flex items-center&quot;&gt;
              &lt;input
                type=&quot;checkbox&quot;
                checked={filters.verified_only}
                onChange={(e) =&gt; handleFiltersChange({ verified_only: e.target.checked })}
                className=&quot;mr-2&quot;
              /&gt;
              &lt;span className=&quot;text-sm&quot;&gt;Color</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/optimization/optimization-controls.tsx (Line 477:6 - Line 486:11), src/components/optimization/optimization-controls.tsx (Line 324:6 - Line 333:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn173" onclick="toggleCodeBlock('cloneGroup173', 'expandBtn173', 'collapseBtn173')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup173"><code class="language-tsx text-sm text-gray-800">-verified paints only&lt;/span&gt;
            &lt;/label&gt;
            &lt;label className=&quot;flex items-center&quot;&gt;
              &lt;input
                type=&quot;checkbox&quot;
                checked={filters.calibrated_only}
                onChange={(e) =&gt; handleFiltersChange({ calibrated_only: e.target.checked })}
                className=&quot;mr-2&quot;
              /&gt;
              &lt;span className=&quot;text-sm&quot;&gt;Calibrated</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/mixing-calculator/AccuracyIndicator.tsx (Line 102:2 - Line 112:6), src/components/mixing-calculator/RatioDisplay.tsx (Line 71:2 - Line 81:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn174" onclick="toggleCodeBlock('cloneGroup174', 'expandBtn174', 'collapseBtn174')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup174"><code class="language-tsx text-sm text-gray-800">
        &lt;/div&gt;
      &lt;/div&gt;
    )
  }

  return (
    &lt;div className={`bg-white rounded-lg border border-gray-200 p-4 ${className}`}&gt;
      {/* Header */}
      &lt;div className=&quot;flex items-center justify-between mb-4&quot;&gt;
        &lt;h3 className=&quot;text-lg font-semibold text-gray-800&quot;&gt;Color</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/dashboard/paint-mixing-dashboard.tsx (Line 149:20 - Line 155:22), src/components/paint/paint-library.tsx (Line 208:9 - Line 214:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn175" onclick="toggleCodeBlock('cloneGroup175', 'expandBtn175', 'collapseBtn175')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup175"><code class="language-tsx text-sm text-gray-800">)
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error?.message || 'Optimization failed'</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 18:23 - Line 28:19), src/components/paint/paint-library.tsx (Line 24:2 - Line 34:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn176" onclick="toggleCodeBlock('cloneGroup176', 'expandBtn176', 'collapseBtn176')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup176"><code class="language-tsx text-sm text-gray-800">;
  sortField: string;
  sortDirection: 'asc' | 'desc';
  pagination: {
    page: number;
    limit: number;
    total: number;
  };
}

interface CollectionFormData</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 86:16 - Line 94:2), src/components/paint/paint-library.tsx (Line 96:11 - Line 105:1)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn177" onclick="toggleCodeBlock('cloneGroup177', 'expandBtn177', 'collapseBtn177')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup177"><code class="language-tsx text-sm text-gray-800"> = useCallback(async () =&gt; {
    setState(prev =&gt; ({ ...prev, loading: true, error: null }));

    try {
      const params = new URLSearchParams({
        page: state.pagination.page.toString(),
        limit: state.pagination.limit.toString(),
        sort_field: state.sortField,
        sort_direction: state.sortDirection,</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 113:12 - Line 121:7), src/components/paint/paint-library.tsx (Line 131:7 - Line 139:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn178" onclick="toggleCodeBlock('cloneGroup178', 'expandBtn178', 'collapseBtn178')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup178"><code class="language-tsx text-sm text-gray-800">: result.data || [],
        pagination: {
          ...prev.pagination,
          total: result.pagination?.total_count || 0
        },
        loading: false
      }));

      </code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 136:2 - Line 145:2), src/components/paint/paint-library.tsx (Line 137:2 - Line 146:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn179" onclick="toggleCodeBlock('cloneGroup179', 'expandBtn179', 'collapseBtn179')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup179"><code class="language-tsx text-sm text-gray-800">

    } catch (error) {
      setState(prev =&gt; ({
        ...prev,
        error: error instanceof Error ? error.message : 'Unknown error',
        loading: false
      }));
    }
  }, [state.pagination.page, state.pagination.limit, state.sortField, state.sortDirection, state.filters,</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 158:23 - Line 181:18), src/components/paint/paint-library.tsx (Line 179:13 - Line 202:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn180" onclick="toggleCodeBlock('cloneGroup180', 'expandBtn180', 'collapseBtn180')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup180"><code class="language-tsx text-sm text-gray-800">, value: any) =&gt; {
    setState(prev =&gt; ({
      ...prev,
      filters: { ...prev.filters, [field]: value },
      pagination: { ...prev.pagination, page: 1 }
    }));
  };

  // Handle sorting
  const handleSort = (field: string) =&gt; {
    setState(prev =&gt; ({
      ...prev,
      sortField: field,
      sortDirection: prev.sortField === field &amp;&amp; prev.sortDirection === 'asc' ? 'desc' : 'asc',
      pagination: { ...prev.pagination, page: 1 }
    }));
  };

  // Handle form submission
  const handleFormSubmit = async (e: React.FormEvent) =&gt; {
    e.preventDefault();

    try {
      const url = editingCollection</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 182:18 - Line 193:28), src/components/paint/paint-library.tsx (Line 203:13 - Line 214:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn181" onclick="toggleCodeBlock('cloneGroup181', 'expandBtn181', 'collapseBtn181')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup181"><code class="language-tsx text-sm text-gray-800"> ? 'PATCH' : 'POST';

      const response = await fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error?.message || 'Failed to save collection'</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 212:2 - Line 223:30), src/components/paint/paint-library.tsx (Line 238:13 - Line 249:31)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn182" onclick="toggleCodeBlock('cloneGroup182', 'expandBtn182', 'collapseBtn182')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup182"><code class="language-tsx text-sm text-gray-800">
      });

    } catch (error) {
      setState(prev =&gt; ({
        ...prev,
        error: error instanceof Error ? error.message : 'Unknown error'
      }));
    }
  };

  // Handle collection deletion</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 231:9 - Line 237:30), src/components/paint/paint-library.tsx (Line 208:2 - Line 214:23)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn183" onclick="toggleCodeBlock('cloneGroup183', 'expandBtn183', 'collapseBtn183')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup183"><code class="language-tsx text-sm text-gray-800">
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error?.message || 'Failed to delete collection'</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 240:2 - Line 250:29), src/components/paint/paint-library.tsx (Line 239:2 - Line 249:31)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn184" onclick="toggleCodeBlock('cloneGroup184', 'expandBtn184', 'collapseBtn184')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup184"><code class="language-tsx text-sm text-gray-800">);

    } catch (error) {
      setState(prev =&gt; ({
        ...prev,
        error: error instanceof Error ? error.message : 'Unknown error'
      }));
    }
  };

  // Format statistics display</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 266:12 - Line 277:12), src/components/paint/paint-library.tsx (Line 273:7 - Line 284:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn185" onclick="toggleCodeBlock('cloneGroup185', 'expandBtn185', 'collapseBtn185')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup185"><code class="language-tsx text-sm text-gray-800">...&lt;/div&gt;
      &lt;/div&gt;
    );
  }

  return (
    &lt;div className={`collection-manager bg-white rounded-lg shadow-lg ${className}`}&gt;
      {/* Header */}
      &lt;div className=&quot;p-6 border-b border-gray-200&quot;&gt;
        &lt;div className=&quot;flex items-center justify-between&quot;&gt;
          &lt;div&gt;
            &lt;h2 className=&quot;text-xl font-semibold text-gray-900&quot;&gt;Paint Collections</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 329:6 - Line 339:5), src/components/collection/collection-manager.tsx (Line 318:7 - Line 328:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn186" onclick="toggleCodeBlock('cloneGroup186', 'expandBtn186', 'collapseBtn186')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup186"><code class="language-tsx text-sm text-gray-800">&gt;
          &lt;/div&gt;
          &lt;div&gt;
            &lt;label className=&quot;flex items-center&quot;&gt;
              &lt;input
                type=&quot;checkbox&quot;
                checked={state.filters.archived}
                onChange={(e) =&gt; handleFilterChange('archived', e.target.checked)}
                className=&quot;mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500&quot;
              /&gt;
              &lt;span className=&quot;text-sm text-gray-700&quot;&gt;Show</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 342:2 - Line 352:23), src/components/paint/paint-library.tsx (Line 402:2 - Line 412:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn187" onclick="toggleCodeBlock('cloneGroup187', 'expandBtn187', 'collapseBtn187')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup187"><code class="language-tsx text-sm text-gray-800">
      &lt;/div&gt;

      {/* Error display */}
      {state.error &amp;&amp; (
        &lt;div className=&quot;p-4 bg-red-50 border-l-4 border-red-400 text-red-700&quot;&gt;
          {state.error}
        &lt;/div&gt;
      )}

      {/* Collections grid */</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 471:2 - Line 484:12), src/components/paint/paint-library.tsx (Line 504:2 - Line 517:7)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn188" onclick="toggleCodeBlock('cloneGroup188', 'expandBtn188', 'collapseBtn188')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup188"><code class="language-tsx text-sm text-gray-800">
                &lt;/div&gt;
              );
            })}
          &lt;/div&gt;
        )}

        {/* Pagination */}
        {state.pagination.total &gt; state.pagination.limit &amp;&amp; (
          &lt;div className=&quot;mt-6 flex items-center justify-between&quot;&gt;
            &lt;div className=&quot;text-sm text-gray-700&quot;&gt;
              Showing {((state.pagination.page - 1) * state.pagination.limit) + 1} to{' '}
              {Math.min(state.pagination.page * state.pagination.limit, state.pagination.total)} of{' '}
              {state.pagination.total} collections</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 484:12 - Line 512:35), src/components/paint/paint-library.tsx (Line 517:7 - Line 545:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn189" onclick="toggleCodeBlock('cloneGroup189', 'expandBtn189', 'collapseBtn189')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup189"><code class="language-tsx text-sm text-gray-800">
            &lt;/div&gt;
            &lt;div className=&quot;flex space-x-2&quot;&gt;
              &lt;button
                onClick={() =&gt; setState(prev =&gt; ({
                  ...prev,
                  pagination: { ...prev.pagination, page: prev.pagination.page - 1 }
                }))}
                disabled={state.pagination.page &lt;= 1}
                className=&quot;px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed&quot;
              &gt;
                Previous
              &lt;/button&gt;
              &lt;button
                onClick={() =&gt; setState(prev =&gt; ({
                  ...prev,
                  pagination: { ...prev.pagination, page: prev.pagination.page + 1 }
                }))}
                disabled={state.pagination.page &gt;= Math.ceil(state.pagination.total / state.pagination.limit)}
                className=&quot;px-3 py-2 text-sm text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed&quot;
              &gt;
                Next
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}
      &lt;/div&gt;

      {/* Create/Edit Collection Modal */</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/collection/collection-manager.tsx (Line 569:2 - Line 587:18), src/components/paint/paint-library.tsx (Line 636:3 - Line 654:13)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn190" onclick="toggleCodeBlock('cloneGroup190', 'expandBtn190', 'collapseBtn190')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup190"><code class="language-tsx text-sm text-gray-800">
                &lt;/div&gt;

                &lt;div className=&quot;flex justify-end space-x-3 pt-4&quot;&gt;
                  &lt;button
                    type=&quot;button&quot;
                    onClick={() =&gt; {
                      setShowCreateForm(false);
                      setEditingCollection(null);
                    }}
                    className=&quot;px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50&quot;
                  &gt;
                    Cancel
                  &lt;/button&gt;
                  &lt;button
                    type=&quot;submit&quot;
                    className=&quot;px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700&quot;
                  &gt;
                    {editingCollection</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/auth/SignOutButton.tsx (Line 189:2 - Line 214:18), src/components/auth/SignOutButton.tsx (Line 140:1 - Line 165:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn191" onclick="toggleCodeBlock('cloneGroup191', 'expandBtn191', 'collapseBtn191')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup191"><code class="language-tsx text-sm text-gray-800">}) {
  const router = useRouter()
  const [isLoading, setIsLoading] = useState(false)

  const handleSignOut = async () =&gt; {
    setIsLoading(true)

    try {
      const { error } = await signOut()

      if (!error) {
        router.push('/auth/signin')
        router.refresh()
      }
    } catch (err) {
      console.error('Sign-out error:', err)
    } finally {
      setIsLoading(false)
    }
  }

  return (
    &lt;button
      onClick={handleSignOut}
      disabled={isLoading}
      data-testid=&quot;signout-menu-item</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/auth/EmailSigninForm.tsx (Line 191:17 - Line 197:11), src/components/auth/EmailSigninForm.tsx (Line 161:14 - Line 167:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn192" onclick="toggleCodeBlock('cloneGroup192', 'expandBtn192', 'collapseBtn192')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup192"><code class="language-tsx text-sm text-gray-800"> : undefined}
          className=&quot;w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                     focus:ring-2 focus:ring-blue-500 focus:border-blue-500
                     dark:bg-gray-700 dark:text-white
                     disabled:opacity-50 disabled:cursor-not-allowed
                     aria-[invalid=true]:border-red-500&quot;
          {...register('password'</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/EmailPasswordForm.tsx (Line 75:7 - Line 99:14), src/components/auth/EmailSigninForm.tsx (Line 48:18 - Line 72:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn197" onclick="toggleCodeBlock('cloneGroup197', 'expandBtn197', 'collapseBtn197')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup197"><code class="language-tsx text-sm text-gray-800">),
    mode: 'onSubmit'
  })

  // Check lockout when component mounts and update countdown
  useEffect(() =&gt; {
    if (!isLocked) return

    const interval = setInterval(() =&gt; {
      const email = getValues('email')
      if (!email) return

      const updatedLockout = checkLocalLockout(email)
      setIsLocked(updatedLockout.isLocked)
      setLockoutMinutes(updatedLockout.minutesRemaining)

      if (!updatedLockout.isLocked) {
        clearInterval(interval)
      }
    }, 60000) // Update every minute

    return () =&gt; clearInterval(interval)
  }, [isLocked, getValues])

  const onSubmit = async (data: LoginFormData</code></pre></div><div class="py-4"><p class="text-gray-600">src/components/EmailPasswordForm.tsx (Line 223:17 - Line 230:9), src/components/EmailPasswordForm.tsx (Line 190:14 - Line 197:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn198" onclick="toggleCodeBlock('cloneGroup198', 'expandBtn198', 'collapseBtn198')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup198"><code class="language-tsx text-sm text-gray-800"> : undefined}
          className=&quot;w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg
                     bg-white dark:bg-gray-800 text-gray-900 dark:text-white
                     focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                     disabled:opacity-50 disabled:cursor-not-allowed
                     aria-[invalid=true]:border-red-500&quot;
        /&gt;
        {errors.password</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/page.tsx (Line 192:2 - Line 201:4), src/app/history/page.tsx (Line 128:2 - Line 137:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn199" onclick="toggleCodeBlock('cloneGroup199', 'expandBtn199', 'collapseBtn199')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup199"><code class="language-tsx text-sm text-gray-800">

  return (
    &lt;div className=&quot;min-h-screen bg-gray-50&quot;&gt;
      {/* Header */}
      &lt;header className=&quot;bg-white shadow-sm border-b border-gray-200&quot;&gt;
        &lt;div className=&quot;max-w-7xl mx-auto px-4 sm:px-6 lg:px-8&quot;&gt;
          &lt;div className=&quot;flex items-center justify-between h-16&quot;&gt;
            &lt;div className=&quot;flex items-center gap-3&quot;&gt;
              &lt;div</code></pre></div><div class="py-4"><p class="text-gray-600">src/app/page.tsx (Line 447:2 - Line 465:20), src/app/history/page.tsx (Line 195:2 - Line 213:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn200" onclick="toggleCodeBlock('cloneGroup200', 'expandBtn200', 'collapseBtn200')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup200"><code class="language-tsx text-sm text-gray-800">

        {/* Error Display */}
        {error &amp;&amp; (
          &lt;div className=&quot;bg-red-50 border border-red-200 rounded-lg p-4 mb-6&quot;&gt;
            &lt;div className=&quot;flex items-center gap-2&quot;&gt;
              &lt;svg className=&quot;w-5 h-5 text-red-500&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;
                &lt;path
                  fillRule=&quot;evenodd&quot;
                  d=&quot;M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z&quot;
                  clipRule=&quot;evenodd&quot;
                /&gt;
              &lt;/svg&gt;
              &lt;p className=&quot;text-sm text-red-600&quot;&gt;{error}&lt;/p&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        )}

        {/* Loading State */</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="css-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">css</h2><div class="divide-y divide-gray-200 border-b-2"><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>